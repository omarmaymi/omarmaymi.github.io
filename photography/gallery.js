document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("gallery");let t=document.getElementById("loading"),n=0,o=[],i=0;if(!e)return void console.error("Gallery element not found");if(t||(t=document.createElement("div"),t.className="loading",t.textContent="Loading...",e.parentNode.insertBefore(t,e.nextSibling)),"undefined"==typeof images)return console.error("Image list not loaded. Please check if image-list.js is properly loaded."),void(t.textContent="Error loading images. Please refresh the page.");o=function(e){const t=[...e];for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}(images);let s=0,a=!1;function l(e,t){const s=document.createElement("div");s.className="gallery-item",s.style.setProperty("--stagger-delay",40*t+"ms");const a=document.createElement("img");return a.loading="lazy",a.decoding="async",a.src=e.src,a.alt=e.alt,a.onerror=()=>{console.error(`Failed to load image: ${e.src}`),s.classList.add("error"),s.innerHTML='<div class="error-message">Failed to load image</div>',r()},a.onload=()=>{s.classList.add("loaded"),i++,r()},s.addEventListener("click",(()=>{!function(e,t,i){const s=document.createElement("div");s.className="fullscreen-view";const a=document.createElement("div");a.className="fullscreen-content";const l=document.createElement("img");l.src=e,l.alt=t;const r=i.getBoundingClientRect(),m=r.width/window.innerWidth,g=r.left+r.width/2-window.innerWidth/2,u=r.top+r.height/2-window.innerHeight/2;l.style.transform=`translate(${g}px, ${u}px) scale(${m})`;const p=document.createElement("button");p.className="close-button",p.innerHTML="&times;",p.onclick=e=>{e.stopPropagation(),d(s,i)};const h=document.createElement("button");h.className="nav-button prev-button",h.innerHTML="&lt;",h.onclick=e=>{e.stopPropagation(),c(-1,l)};const f=document.createElement("button");f.className="nav-button next-button",f.innerHTML="&gt;",f.onclick=e=>{e.stopPropagation(),c(1,l)},a.appendChild(l),a.appendChild(p),a.appendChild(h),a.appendChild(f),s.appendChild(a),document.body.appendChild(s),requestAnimationFrame((()=>{s.classList.add("active"),l.classList.add("animate")})),s.addEventListener("click",(e=>{e.target===s&&d(s,i)})),n=o.findIndex((t=>t.fullsize===e))}(e.fullsize,e.alt,s)})),s.appendChild(a),s}function r(){i>=o.length&&(t.style.display="none")}function d(e,t){const n=e.querySelector("img"),o=t.getBoundingClientRect(),i=o.width/window.innerWidth,s=o.left+o.width/2-window.innerWidth/2,a=o.top+o.height/2-window.innerHeight/2;n.classList.remove("animate"),n.style.transform=`translate(${s}px, ${a}px) scale(${i})`,e.classList.remove("active"),e.addEventListener("transitionend",(function t(){e.parentNode&&e.parentNode.removeChild(e),e.removeEventListener("transitionend",t)}))}function c(e,t){const i=(n+e+o.length)%o.length,s=o[i];n=i,t.style.opacity="0",setTimeout((()=>{t.src=s.fullsize,t.alt=s.alt,t.style.opacity="1"}),300)}const m=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&(e.target.classList.add("visible"),m.unobserve(e.target))}))}),{threshold:.1,rootMargin:"200px"});function g(){if(a)return;a=!0;const n=s,i=Math.min(s+20,o.length);0===n&&setTimeout((()=>{t&&(t.style.display="none",t.style.visibility="hidden",t.style.opacity="0")}),100);for(let t=n;t<i;t++){const n=l(o[t],t);e.appendChild(n),m.observe(n)}s=i,a=!1,s>=o.length&&window.removeEventListener("scroll",u)}function u(){window.innerHeight+window.scrollY>document.body.offsetHeight-600&&g()}g(),window.addEventListener("scroll",u)}));