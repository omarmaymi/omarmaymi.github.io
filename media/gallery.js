document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("gallery");let n=document.getElementById("loading"),t=0,o=[],l=0;if(!e)return void console.error("Gallery element not found");if(n||(n=document.createElement("div"),n.className="loading",n.textContent="Loading...",e.parentNode.insertBefore(n,e.nextSibling)),"undefined"==typeof videos)return console.error("Video list not loaded. Please check if media-list.js is properly loaded."),void(n.textContent="Error loading videos. Please refresh the page.");console.log("Videos array loaded:",videos.length,"videos found"),o=function(e){const n=[...e];for(let e=n.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[n[e],n[t]]=[n[t],n[e]]}return n}(videos),console.log("Videos shuffled:",o.length,"videos");let d=0,i=!1;function a(e,n){const d=document.createElement("div");d.className="gallery-item",d.style.setProperty("--stagger-delay",40*n+"ms");const i=document.createElement("div");i.className="thumbnail-container";const a=document.createElement("img");a.loading="lazy",a.decoding="async",a.src=e.thumbnail,a.alt=e.title;const c=document.createElement("video");c.className="preview-video",c.src=e.preview,c.muted=!0,c.loop=!0,c.playsInline=!0;const m=document.createElement("div");return m.className="play-icon",m.innerHTML='<i class="fas fa-play"></i>',a.onerror=()=>{console.error(`Failed to load thumbnail: ${e.thumbnail}`),d.classList.add("error"),d.innerHTML='<div class="error-message">Failed to load thumbnail</div>',s()},a.onload=()=>{console.log(`Successfully loaded thumbnail: ${e.thumbnail}`),d.classList.add("loaded"),l++,s()},d.addEventListener("mouseenter",(()=>{c.play().catch((e=>{console.error("Error playing preview video:",e)}))})),d.addEventListener("mouseleave",(()=>{c.pause(),c.currentTime=0})),d.addEventListener("click",(()=>{!function(e){const n=document.createElement("div");n.className="fullscreen-view";const l=document.createElement("div");l.className="fullscreen-content";const d=document.createElement("iframe");d.src=e.embedUrl,d.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",d.allowFullscreen=!0;const i=document.createElement("button");i.className="close-button",i.innerHTML="&times;",i.onclick=()=>{document.body.removeChild(n)};const a=document.createElement("button");a.className="nav-button prev-button",a.innerHTML="&lt;",a.onclick=e=>{e.stopPropagation(),r(-1,d)};const s=document.createElement("button");s.className="nav-button next-button",s.innerHTML="&gt;",s.onclick=e=>{e.stopPropagation(),r(1,d)},l.appendChild(d),l.appendChild(i),l.appendChild(a),l.appendChild(s),n.appendChild(l),document.body.appendChild(n),n.addEventListener("click",(e=>{e.target===n&&document.body.removeChild(n)})),t=o.findIndex((n=>n.embedUrl===e.embedUrl))}(e)})),i.appendChild(a),i.appendChild(c),d.appendChild(i),d.appendChild(m),d}function s(){l>=o.length&&(console.log("All videos loaded, hiding loading indicator"),n.style.display="none")}function r(e,n){const l=(t+e+o.length)%o.length,d=o[l];t=l,n.src=d.embedUrl}const c=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&(e.target.classList.add("visible"),c.unobserve(e.target))}))}),{threshold:.1,rootMargin:"200px"});function m(){if(i)return;i=!0;const t=d,l=Math.min(d+12,o.length);console.log(`Loading batch ${t} to ${l}`),0===t&&(console.log("First batch starting, hiding loading indicator"),setTimeout((()=>{n&&(n.style.display="none",n.style.visibility="hidden",n.style.opacity="0")}),100));for(let n=t;n<l;n++){const t=a(o[n],n);e.appendChild(t),c.observe(t)}d=l,i=!1,d>=o.length&&(console.log("All batches loaded"),window.removeEventListener("scroll",u))}function u(){window.innerHeight+window.scrollY>document.body.offsetHeight-600&&m()}m(),window.addEventListener("scroll",u)}));