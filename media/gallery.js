document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("gallery");let t=document.getElementById("loading"),n=0,o=[],l=0;if(!e)return void console.error("Gallery element not found");if(t||(t=document.createElement("div"),t.className="loading",t.textContent="Loading...",e.parentNode.insertBefore(t,e.nextSibling)),"undefined"==typeof videos)return console.error("Video list not loaded. Please check if media-list.js is properly loaded."),void(t.textContent="Error loading videos. Please refresh the page.");o=function(e){const t=[...e];for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}(videos);let d=0,i=!1;function r(e,t){const d=document.createElement("div");d.className="gallery-item",d.style.setProperty("--stagger-delay",40*t+"ms");const i=document.createElement("div");i.className="thumbnail-container";const r=document.createElement("img");r.loading="lazy",r.decoding="async",r.src=e.thumbnail,r.alt=e.title;const s=document.createElement("video");s.className="preview-video",s.src=e.preview,s.muted=!0,s.loop=!0,s.playsInline=!0;const m=document.createElement("div");return m.className="play-icon",m.innerHTML='<i class="fas fa-play"></i>',r.onerror=()=>{console.error(`Failed to load thumbnail: ${e.thumbnail}`),d.classList.add("error"),d.innerHTML='<div class="error-message">Failed to load thumbnail</div>',a()},r.onload=()=>{d.classList.add("loaded"),l++,a()},d.addEventListener("mouseenter",(()=>{s.play().catch((e=>{console.error("Error playing preview video:",e)}))})),d.addEventListener("mouseleave",(()=>{s.pause(),s.currentTime=0})),d.addEventListener("click",(()=>{!function(e){const t=document.createElement("div");t.className="fullscreen-view";const l=document.createElement("div");l.className="fullscreen-content";const d=document.createElement("iframe");d.src=e.embedUrl,d.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",d.allowFullscreen=!0;const i=document.createElement("button");i.className="close-button",i.innerHTML="&times;",i.onclick=()=>{document.body.removeChild(t)};const r=document.createElement("button");r.className="nav-button prev-button",r.innerHTML="&lt;",r.onclick=e=>{e.stopPropagation(),c(-1,d)};const a=document.createElement("button");a.className="nav-button next-button",a.innerHTML="&gt;",a.onclick=e=>{e.stopPropagation(),c(1,d)},l.appendChild(d),l.appendChild(i),l.appendChild(r),l.appendChild(a),t.appendChild(l),document.body.appendChild(t),t.addEventListener("click",(e=>{e.target===t&&document.body.removeChild(t)})),n=o.findIndex((t=>t.embedUrl===e.embedUrl))}(e)})),i.appendChild(r),i.appendChild(s),d.appendChild(i),d.appendChild(m),d}function a(){l>=o.length&&(t.style.display="none")}function c(e,t){const l=(n+e+o.length)%o.length,d=o[l];n=l,t.src=d.embedUrl}const s=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&(e.target.classList.add("visible"),s.unobserve(e.target))}))}),{threshold:.1,rootMargin:"200px"});function m(){if(i)return;i=!0;const n=d,l=Math.min(d+12,o.length);0===n&&setTimeout((()=>{t&&(t.style.display="none",t.style.visibility="hidden",t.style.opacity="0")}),100);for(let t=n;t<l;t++){const n=r(o[t],t);e.appendChild(n),s.observe(n)}d=l,i=!1,d>=o.length&&window.removeEventListener("scroll",u)}function u(){window.innerHeight+window.scrollY>document.body.offsetHeight-600&&m()}m(),window.addEventListener("scroll",u)}));